{% extends 'base.html' %} {% load static %} {% block content %}

<div class="min-h-screen bg-gray-50 py-10">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Back Button -->
    <div class="mb-8">
      <a
        href="{% url 'main:show_main' %}"
        class="inline-flex items-center text-[#db1d24] hover:text-red-700 font-semibold transition-colors duration-300"
      >
        <svg
          class="w-5 h-5 mr-2"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          ></path>
        </svg>
        Back to Products
      </a>
    </div>

    <!-- Loading State -->
    <div id="loading-container" class="hidden">
      <div class="bg-white rounded-xl shadow-lg overflow-hidden animate-pulse">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Image Skeleton -->
          <div class="relative h-96 lg:h-full bg-gray-200"></div>

          <!-- Content Skeleton -->
          <div class="p-8">
            <div class="mb-6">
              <div class="h-10 bg-gray-200 rounded mb-4"></div>
              <div class="w-24 h-1 bg-gray-200 rounded-full mb-6"></div>
            </div>

            <div class="mb-8">
              <div class="h-12 bg-gray-200 rounded mb-2"></div>
              <div class="h-4 bg-gray-200 rounded w-32"></div>
            </div>

            <div class="mb-8">
              <div class="h-6 bg-gray-200 rounded mb-4 w-24"></div>
              <div class="space-y-2">
                <div class="h-4 bg-gray-200 rounded"></div>
                <div class="h-4 bg-gray-200 rounded"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4"></div>
              </div>
            </div>

            <div class="bg-gray-100 rounded-lg p-6 mb-8">
              <div class="h-6 bg-gray-200 rounded mb-4 w-32"></div>
              <div class="grid grid-cols-2 gap-4">
                <div class="h-4 bg-gray-200 rounded"></div>
                <div class="h-4 bg-gray-200 rounded"></div>
                <div class="h-4 bg-gray-200 rounded"></div>
                <div class="h-4 bg-gray-200 rounded"></div>
              </div>
            </div>

            <div class="flex gap-4">
              <div class="flex-1 h-12 bg-gray-200 rounded-lg"></div>
              <div class="w-16 h-12 bg-gray-200 rounded-lg"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error State -->
    <div id="error-container" class="hidden">
      <div
        class="bg-white rounded-xl shadow-lg overflow-hidden p-8 text-center"
      >
        <div class="bg-red-100 rounded-full p-4 mb-4 inline-block">
          <svg
            class="w-12 h-12 text-red-500"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"
            ></path>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Product Not Found</h2>
        <p id="error-message" class="text-gray-600 mb-6">
          The product you're looking for could not be found or an error occurred
          while loading.
        </p>
        <button
          onclick="loadProduct()"
          class="inline-flex items-center px-6 py-3 rounded-full font-semibold text-white bg-gradient-primary hover:bg-gradient-primary-hover transition-all duration-300 hover:-translate-y-0.5 shadow-lg hover:shadow-xl"
        >
          <svg
            class="w-5 h-5 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            ></path>
          </svg>
          Try Again
        </button>
      </div>
    </div>

    <!-- Product Detail -->
    <div id="product-container" class="hidden">
      <div
        class="bg-white rounded-xl shadow-lg overflow-hidden animate-fade-in"
      >
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Product Image -->
          <div class="relative h-96 lg:h-full">
            <img
              id="product-image"
              src=""
              alt=""
              class="w-full h-full object-cover"
              onerror="this.src='/static/images/product.jpg'"
            />
            <div
              id="featured-badge"
              class="hidden absolute top-4 left-4 bg-gradient-primary text-white px-4 py-2 rounded-full text-sm font-bold uppercase shadow-lg"
            >
              Featured
            </div>
            <div
              id="category-badge"
              class="absolute top-4 right-4 bg-black/70 text-white px-4 py-2 rounded-full text-sm backdrop-blur-sm"
            >
              <!-- Category will be populated by JS -->
            </div>
          </div>

          <!-- Product Information -->
          <div class="p-8">
            <div class="mb-6">
              <h1
                id="product-name"
                class="text-4xl font-bold text-gray-900 mb-4"
              >
                <!-- Name will be populated by JS -->
              </h1>
              <div
                class="w-24 h-1 bg-gradient-to-r from-[#db1d24] to-red-600 rounded-full mb-6"
              ></div>
            </div>

            <!-- Price -->
            <div class="mb-8">
              <div
                id="product-price"
                class="text-4xl font-bold text-[#db1d24] mb-2"
              >
                <!-- Price will be populated by JS -->
              </div>
              <p class="text-gray-600">Price includes VAT</p>
            </div>

            <!-- Description -->
            <div class="mb-8">
              <h3 class="text-xl font-semibold text-gray-900 mb-4">
                Description
              </h3>
              <p id="product-description" class="text-gray-700 leading-relaxed">
                <!-- Description will be populated by JS -->
              </p>
            </div>

            <!-- Product Details -->
            <div class="bg-gray-50 rounded-lg p-6 mb-8">
              <h3 class="text-xl font-semibold text-gray-900 mb-4">
                Product Details
              </h3>
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span class="font-semibold text-gray-700">Category:</span>
                  <span id="detail-category" class="text-gray-600 ml-2">
                    <!-- Category will be populated by JS -->
                  </span>
                </div>
                <div>
                  <span class="font-semibold text-gray-700">Featured:</span>
                  <span id="detail-featured" class="text-gray-600 ml-2">
                    <!-- Featured status will be populated by JS -->
                  </span>
                </div>
                <div>
                  <span class="font-semibold text-gray-700">Added:</span>
                  <span id="detail-created" class="text-gray-600 ml-2">
                    <!-- Created date will be populated by JS -->
                  </span>
                </div>
                <div>
                  <span class="font-semibold text-gray-700">Updated:</span>
                  <span id="detail-updated" class="text-gray-600 ml-2">
                    <!-- Updated date will be populated by JS -->
                  </span>
                </div>
                <div>
                  <span class="font-semibold text-gray-700">Author:</span>
                  <span id="detail-author" class="text-gray-600 ml-2">
                    <!-- Author will be populated by JS -->
                  </span>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4">
              <button
                class="flex-1 bg-gradient-primary hover:bg-gradient-primary-hover text-white font-semibold py-4 px-8 rounded-lg transition-all duration-300 hover:-translate-y-0.5 shadow-lg hover:shadow-xl flex items-center justify-center"
              >
                <svg
                  class="w-5 h-5 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 3h2l.4 2M7 13h10l4-8H5.4m-2.4-2L3 3m4 10v6a1 1 0 001 1h3m-4-7h.01M16 20a1 1 0 100-2 1 1 0 000 2zM9 20a1 1 0 100-2 1 1 0 000 2z"
                  ></path>
                </svg>
                Add to Cart
              </button>
              <button
                class="px-6 py-4 border-2 border-gray-300 text-gray-700 hover:border-[#db1d24] hover:text-[#db1d24] rounded-lg transition-all duration-300 flex items-center justify-center"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                  ></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CSS Animations -->
<style>
  .product-detail-animation {
    opacity: 0;
    transform: translateY(20px) scale(0.98);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .product-detail-animation.animate-in {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  .skeleton-pulse {
    animation: skeleton-pulse 2s infinite;
  }

  @keyframes skeleton-pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.4;
    }
  }
</style>

<!-- JavaScript -->
<script>
  // Get product ID from URL
  const productId = "{{ product.id|default:'' }}";

  // State management
  let isLoading = false;

  // DOM elements
  const loadingContainer = document.getElementById("loading-container");
  const errorContainer = document.getElementById("error-container");
  const productContainer = document.getElementById("product-container");

  // Category mapping
  const categoryMap = {
    jersey: "Jersey",
    accessories: "Accessories",
    shoes: "Shoes",
    training: "Training",
    lifestyle: "Lifestyle",
  };

  // Load product data
  async function loadProduct() {
    if (isLoading || !productId) return;

    showLoading();

    try {
      const response = await fetch(`/json/${productId}/`);

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const product = await response.json();

      if (product.error) {
        throw new Error(product.error);
      }

      populateProductData(product);
      showProduct();
    } catch (error) {
      console.error("Error loading product:", error);
      showError(error.message || "Failed to load product");
    }
  }

  // Show loading state
  function showLoading() {
    isLoading = true;
    hideAllStates();
    loadingContainer.classList.remove("hidden");
  }

  // Show error state
  function showError(message) {
    isLoading = false;
    hideAllStates();
    errorContainer.classList.remove("hidden");

    const errorMessage = document.getElementById("error-message");
    if (errorMessage) {
      errorMessage.textContent =
        message || "An error occurred while loading the product.";
    }
  }

  // Show product
  function showProduct() {
    isLoading = false;
    hideAllStates();
    productContainer.classList.remove("hidden");

    // Add animation
    const productDetail = productContainer.querySelector(".bg-white");
    if (productDetail) {
      productDetail.classList.add("product-detail-animation");
      setTimeout(() => {
        productDetail.classList.add("animate-in");
      }, 50);
    }
  }

  // Hide all states
  function hideAllStates() {
    loadingContainer.classList.add("hidden");
    errorContainer.classList.add("hidden");
    productContainer.classList.add("hidden");

    // Remove animation classes
    const productDetail = productContainer.querySelector(".bg-white");
    if (productDetail) {
      productDetail.classList.remove("product-detail-animation", "animate-in");
    }
  }

  // Populate product data
  function populateProductData(product) {
    // Basic info
    document.getElementById("product-name").textContent =
      product.name || "Unknown Product";
    document.getElementById("product-description").textContent =
      product.description || "No description available";

    // Price
    const price = parseFloat(product.price);
    document.getElementById(
      "product-price"
    ).textContent = `IDR ${price.toLocaleString()}`;

    // Image
    const productImage = document.getElementById("product-image");
    productImage.src = product.thumbnail || "/static/images/product.jpg";
    productImage.alt = product.name || "Product Image";

    // Featured badge
    const featuredBadge = document.getElementById("featured-badge");
    if (product.is_featured) {
      featuredBadge.classList.remove("hidden");
    } else {
      featuredBadge.classList.add("hidden");
    }

    // Category badge
    const categoryDisplay =
      categoryMap[product.category] || product.category || "Unknown";
    document.getElementById("category-badge").textContent = categoryDisplay;

    // Product details
    document.getElementById("detail-category").textContent = categoryDisplay;
    document.getElementById("detail-featured").textContent = product.is_featured
      ? "Yes"
      : "No";
    document.getElementById("detail-author").textContent =
      product.user_id || "Anonymous";

    // Dates
    if (product.created_at) {
      const createdDate = new Date(product.created_at);
      document.getElementById("detail-created").textContent =
        createdDate.toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
    }

    if (product.updated_at) {
      const updatedDate = new Date(product.updated_at);
      document.getElementById("detail-updated").textContent =
        updatedDate.toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
    }
  }

  // Initialize on page load
  document.addEventListener("DOMContentLoaded", function () {
    if (productId) {
      loadProduct();
    } else {
      showError("Product ID not found");
    }
  });
</script>

{% endblock content %}
